<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Global Feed with Auth</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

<style>
/* Early 2000s Retro Theme */
body {
  margin: 0;
  font-family: "Courier New", Courier, monospace;
  background: #c0c0c0;
  color: #000080;
}

.navbar {
  background: #000080;
  color: #fff;
  padding: 10px;
  display: flex;
  align-items: center;
  gap: 10px;
  flex-wrap: wrap;
}

.navbar button {
  cursor: pointer;
  padding: 5px 10px;
  color: #fff;
  background: #800000;
  border: 1px solid #fff;
  font-weight: bold;
}

.navbar button:hover {
  background: #ff0000;
}

.page {
  display: none;
  padding: 20px;
}

#login, #signup {
  display: block;
}

input {
  padding: 5px;
  border: 1px solid #000080;
  margin-bottom: 10px;
  width: 100%;
  max-width: 300px;
}

button {
  font-family: "Courier New", monospace;
}

.post {
  border: 2px solid #000080;
  padding: 10px;
  margin-bottom: 10px;
  position: relative;
  background: #fffacd;
}

.post button.delete {
  position: absolute;
  top: 5px;
  right: 5px;
  background: red;
  color: white;
  border: none;
  padding: 3px 7px;
  cursor: pointer;
}

.tag {
  background: #00f;
  color: #fff;
  padding: 2px 5px;
  margin-left: 5px;
  font-size: 12px;
  border-radius: 3px;
}

/* Scrollable feed */
#posts {
  max-height: 70vh;
  overflow-y: auto;
  padding-right: 10px;
}

/* Responsive media */
img, video {
  max-width: 100%;
  height: auto;
  display: block;
  margin-top: 10px;
}

/* Early 2000s buttons and links style */
a {
  color: #000080;
  text-decoration: underline;
}

a:hover {
  color: #ff0000;
  cursor: pointer;
}

/* Mobile responsiveness */
@media (max-width: 600px) {
  .navbar {
    flex-direction: column;
    align-items: flex-start;
  }
  input {
    max-width: 100%;
  }
}
</style>
</head>
<body>

<div class="navbar">
  <span id="userEmail">Not signed in</span>
  <button id="logoutBtn" onclick="logout()">Logout</button>
  <button onclick="show('home')">Home</button>
  <button onclick="show('post')">Post</button>
</div>

<!-- LOGIN PAGE -->
<div id="login" class="page">
  <h2>Login</h2>
  <input type="email" id="loginEmail" placeholder="Email"><br>
  <input type="password" id="loginPass" placeholder="Password"><br>
  <button onclick="login()">Login</button>
  <p>No account? <a href="#" onclick="show('signup')">Sign Up</a></p>
</div>

<!-- SIGNUP PAGE -->
<div id="signup" class="page">
  <h2>Sign Up</h2>
  <input type="email" id="signupEmail" placeholder="Email"><br>
  <input type="password" id="signupPass" placeholder="Password"><br>
  <button onclick="signup()">Sign Up</button>
  <p>Already have account? <a href="#" onclick="show('login')">Login</a></p>
</div>

<!-- HOME FEED -->
<div id="home" class="page">
  <h2>Global Feed</h2>
  <div id="posts"></div>
</div>

<!-- CREATE POST -->
<div id="post" class="page">
  <h2>Create Post</h2>
  <input id="title" placeholder="Title"><br>
  <input type="file" id="file" accept="image/*,video/*"><br>
  <button onclick="publish()">Publish</button>
</div>

<script>
// FIREBASE INIT
firebase.initializeApp({
  apiKey: "AIzaSyDZYK8wRGXJNlGYNosolSo2zeEjLrqd4Eg",
  authDomain: "pastebin-604ee.firebaseapp.com",
  projectId: "pastebin-604ee"
});

const auth = firebase.auth();
const db = firebase.firestore();

// SHOW PAGE FUNCTION
function show(id){
  document.querySelectorAll('.page').forEach(p=>p.style.display='none');
  document.getElementById(id).style.display='block';
}

// AUTH STATE
auth.onAuthStateChanged(user=>{
  if(user){
    document.getElementById('userEmail').textContent = user.email + ' (AndreKriegman)';
    document.getElementById('logoutBtn').style.display='inline';
    show('home');
    loadPosts();
  } else {
    document.getElementById('userEmail').textContent='Not signed in';
    document.getElementById('logoutBtn').style.display='none';
    show('login');
  }
});

// SIGNUP / LOGIN
function signup(){
  const email=signupEmail.value;
  const pass=signupPass.value;
  auth.createUserWithEmailAndPassword(email,pass)
  .catch(e=>alert(e.message));
}
function login(){
  const email=loginEmail.value;
  const pass=loginPass.value;
  auth.signInWithEmailAndPassword(email,pass)
  .catch(e=>alert(e.message));
}
function logout(){ auth.signOut(); }

// CREATE POST
function publish(){
  const user=auth.currentUser;
  if(!user) return alert("Login first");
  const t=title.value.trim();
  const f=file.files[0];
  if(!t||!f) return alert("Missing data");
  if(!f.type.startsWith("image/")&&!f.type.startsWith("video/")) return alert("Media only");

  const r=new FileReader();
  r.onload=()=>{
    db.collection("posts").add({
      title:t,
      media:r.result,
      type:f.type,
      author:user.email,
      time:firebase.firestore.FieldValue.serverTimestamp()
    });
    title.value=""; file.value="";
  };
  r.readAsDataURL(f);
}

// LOAD POSTS
function loadPosts(){
  db.collection("posts").orderBy("time","desc").onSnapshot(s=>{
    posts.innerHTML="";
    s.forEach(d=>{
      const p=d.data();
      const div=document.createElement("div");
      div.className='post';
      div.innerHTML=`<strong>${p.title}</strong> <span class="tag">AndreKriegman</span><br>`;
      div.innerHTML+=p.type.startsWith("image")?`<img src="${p.media}">`:`<video src="${p.media}" controls></video>`;
      if(auth.currentUser.email==='exoticslash3r@gmail.com'){
        const del=document.createElement("button");
        del.textContent="Delete";
        del.className="delete";
        del.onclick=(e)=>{
          e.stopPropagation();
          if(confirm("Delete post?")) db.collection("posts").doc(d.id).delete();
        };
        div.appendChild(del);
      }
      posts.appendChild(div);
    });
  });
}
</script>

</body>
</html>
